"use strict";(globalThis.webpackChunkai_book=globalThis.webpackChunkai_book||[]).push([[5977],{3992(e,s,t){t.r(s),t.d(s,{default:()=>r});var a=t(6540),n=t(4848);const r=()=>{const[e,s]=(0,a.useState)(!1),[t,r]=(0,a.useState)([]),[o,c]=(0,a.useState)(""),[i,l]=(0,a.useState)(!1),[d,h]=(0,a.useState)(null),u=(0,a.useRef)(null);(0,a.useEffect)(()=>{u.current?.scrollIntoView({behavior:"smooth"})},[t]);const m=async()=>{if(!o.trim()||i)return;const e={id:Date.now(),text:o,sender:"user",timestamp:new Date};r(s=>[...s,e]),c(""),l(!0),h(null);try{const e={page:window.location.pathname,chapter:document.querySelector("h1")?.textContent||"Unknown Chapter"},s=await fetch("http://localhost:8000/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:o,...e})});if(!s.ok)throw new Error(`Server error: ${s.status}`);const t=await s.json(),a={id:Date.now()+1,text:t.response,sender:"bot",sources:t.sources||[],timestamp:new Date};r(e=>[...e,a])}catch(s){h("Failed to get response. Please try again."),console.error("Chat error:",s)}finally{l(!1)}};return(0,n.jsxs)("div",{className:"chat-widget",children:[!e&&(0,n.jsx)("button",{className:"chat-toggle-button",onClick:()=>s(!0),"aria-label":"Open chat",children:"\ud83d\udcac"}),e&&(0,n.jsxs)("div",{className:"chat-container",children:[(0,n.jsxs)("div",{className:"chat-header",children:[(0,n.jsx)("h3",{children:"Book Assistant"}),(0,n.jsx)("button",{className:"close-button",onClick:()=>s(!1),"aria-label":"Close chat",children:"\xd7"})]}),(0,n.jsxs)("div",{className:"chat-messages",children:[0===t.length?(0,n.jsx)("div",{className:"welcome-message",children:(0,n.jsx)("p",{children:"Hello! I'm your book assistant. Ask me anything about the content you're reading."})}):t.map(e=>(0,n.jsxs)("div",{className:`message ${e.sender}`,children:[(0,n.jsx)("div",{className:"message-text",children:e.text}),e.sources&&e.sources.length>0&&(0,n.jsxs)("div",{className:"sources",children:["Sources: ",e.sources.map((e,s)=>(0,n.jsx)("span",{className:"source",children:e.chapter},s)).reduce((e,s)=>[e,", ",s])]}),(0,n.jsx)("div",{className:"timestamp",children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},e.id)),i&&(0,n.jsx)("div",{className:"message bot",children:(0,n.jsxs)("div",{className:"typing-indicator",children:[(0,n.jsx)("span",{}),(0,n.jsx)("span",{}),(0,n.jsx)("span",{})]})}),(0,n.jsx)("div",{ref:u})]}),d&&(0,n.jsx)("div",{className:"error-message",children:d}),(0,n.jsxs)("div",{className:"chat-input-area",children:[(0,n.jsx)("textarea",{value:o,onChange:e=>c(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),m())},placeholder:"Ask about the book content...",rows:"1",disabled:i}),(0,n.jsx)("button",{onClick:m,disabled:!o.trim()||i,className:"send-button",children:"Send"})]})]})]})}}}]);